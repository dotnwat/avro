cmake_minimum_required(VERSION 3.26)
project(avro)

list(APPEND CMAKE_MODULE_PATH lang/c++/cmake)

find_package(Snappy)

find_package (Boost 1.78 REQUIRED
  COMPONENTS iostreams system)

add_library(avro
  lang/c++/impl/Compiler.cc
  lang/c++/impl/Node.cc
  lang/c++/impl/LogicalType.cc
  lang/c++/impl/NodeImpl.cc
  lang/c++/impl/ResolverSchema.cc
  lang/c++/impl/Schema.cc
  lang/c++/impl/Types.cc
  lang/c++/impl/ValidSchema.cc
  lang/c++/impl/Zigzag.cc
  lang/c++/impl/BinaryEncoder.cc
  lang/c++/impl/BinaryDecoder.cc
  lang/c++/impl/Stream.cc
  lang/c++/impl/FileStream.cc
  lang/c++/impl/Generic.cc
  lang/c++/impl/GenericDatum.cc
  lang/c++/impl/DataFile.cc
  lang/c++/impl/parsing/Symbol.cc
  lang/c++/impl/parsing/ValidatingCodec.cc
  lang/c++/impl/parsing/JsonCodec.cc
  lang/c++/impl/parsing/ResolvingDecoder.cc
  lang/c++/impl/json/JsonIO.cc
  lang/c++/impl/json/JsonDom.cc
  lang/c++/impl/Resolver.cc
  lang/c++/impl/Validator.cc
  lang/c++/impl/CustomAttributes.cc)

if(SNAPPY_FOUND)
  target_compile_definitions(avro PUBLIC SNAPPY_CODEC_AVAILABLE)
endif()

target_link_libraries(avro
    Boost::iostreams
    Boost::system)

target_include_directories(avro
  PUBLIC lang/c++/include Boost::boost
  PRIVATE lang/c++/include/avro)

add_library(Avro::avro ALIAS avro)
